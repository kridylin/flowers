<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Á†¥Á¢éÈáçÊï¥ËÆ°Âàí</title>
    <style>
        :root {
            --bg-color: #E9F7EF;
            --font-stack: "Songti SC", "Noto Serif SC", serif;
            --text-color: #5A5A5A;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body, html {
            width: 100%; height: 100%;
            background-color: var(--bg-color);
            overflow: hidden;
            font-family: var(--font-stack);
            color: var(--text-color);
            touch-action: none;
            background: linear-gradient(135deg, #E9F7EF 0%, #F5FAFF 100%);
        }

        #app {
            position: relative; width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
        }

        canvas { position: absolute; top: 0; left: 0; z-index: 1; }

        #choice-modal {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(233, 247, 239, 0.95);
            z-index: 50;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            padding: 20px;
            opacity: 0;
            transition: opacity 0.6s;
            pointer-events: none;
        }
        #choice-modal.show {
            opacity: 1;
            pointer-events: auto;
        }

        .choice-content {
            text-align: center;
            max-width: 600px;
        }

        .choice-title {
            font-size: 24px;
            letter-spacing: 2px;
            color: #4A6B5D;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .choice-subtitle {
            font-size: 14px;
            color: #8FAFA0;
            margin-bottom: 40px;
            letter-spacing: 1px;
        }

        .choice-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 30px;
        }

        .choice-btn {
            background: linear-gradient(135deg, #A8E6CF, #DCEDC1);
            color: #4A6B5D;
            border: 2px solid transparent;
            padding: 14px 24px;
            font-family: var(--font-stack);
            font-size: 15px;
            letter-spacing: 1px;
            cursor: pointer;
            border-radius: 30px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(168, 230, 207, 0.3);
            transform: scale(1);
        }

        .choice-btn:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 6px 20px rgba(168, 230, 207, 0.4);
        }

        .choice-btn:active {
            transform: scale(0.98);
            transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .choice-btn.selected {
            background: linear-gradient(135deg, #A8E6CF, #9DD9BC);
            border-color: #5FA894;
            box-shadow: 0 0 25px rgba(95, 168, 148, 0.5), 0 4px 15px rgba(168, 230, 207, 0.4);
            transform: scale(1.03);
        }

        .choice-btn.selected:hover {
            transform: translateY(-2px) scale(1.04);
            box-shadow: 0 0 30px rgba(95, 168, 148, 0.6), 0 6px 20px rgba(168, 230, 207, 0.5);
        }

        .choice-confirm-btn {
            background: linear-gradient(135deg, #5FA894, #4A6B5D);
            color: white;
            border: none;
            padding: 14px 40px;
            font-size: 15px;
            letter-spacing: 2px;
            cursor: pointer;
            border-radius: 30px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(95, 168, 148, 0.3);
            display: inline-flex;
            align-items: center;
            gap: 12px;
            justify-content: center;
            margin: 0 auto;
        }

        .choice-confirm-btn:hover:not(:disabled) {
            transform: translateY(-2px);
        }

        .choice-confirm-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-owl {
            width: 28px;
            height: 28px;
            display: inline-block;
            flex-shrink: 0;
        }

        .ui-layer {
            position: absolute; z-index: 10;
            width: 100%; height: 100%;
            pointer-events: none;
            display: flex; flex-direction: column;
            justify-content: space-between; align-items: center;
            padding: 80px 20px 60px 20px;
            transition: opacity 0.8s;
        }

        .hint-text {
            font-size: 16px; letter-spacing: 2px;
            color: #8FAFA0; text-align: center;
            opacity: 0.85;
            text-shadow: 0 1px 5px rgba(255,255,255,0.8);
            transition: all 0.5s;
            line-height: 1.8;
            font-weight: 300;
            animation: breathe 4s ease-in-out infinite;
        }

        @keyframes breathe {
            0%, 100% { opacity: 0.75; }
            50% { opacity: 0.95; }
        }

        .feedback-text {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 18px;
            letter-spacing: 2px;
            color: #5FA894;
            opacity: 0;
            pointer-events: none;
            z-index: 20;
            animation: feedbackFloat 1.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
            max-width: 80%;
            text-align: center;
            word-wrap: break-word;
            white-space: pre-line;
            line-height: 2;
            padding: 20px;
            font-weight: 300;
        }

        .feedback-text.special {
            font-size: 20px;
            color: #D4A76A;
            font-weight: 400;
            text-shadow: 0 2px 10px rgba(255, 230, 200, 0.6);
            animation: feedbackFloatSpecial 2.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        @keyframes feedbackFloat {
            0% {
                opacity: 0;
                transform: translate(-50%, -45%);
            }
            15% {
                opacity: 1;
            }
            85% {
                opacity: 1;
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -60%);
            }
        }

        @keyframes feedbackFloatSpecial {
            0% {
                opacity: 0;
                transform: translate(-50%, -45%) scale(0.95);
            }
            10% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            90% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -55%) scale(1.05);
            }
        }

        .flower-counter {
            position: absolute;
            bottom: 40px;
            right: 20px;
            font-size: 14px;
            color: #8FAFA0;
            letter-spacing: 1px;
            opacity: 0;
            transition: opacity 0.4s;
            pointer-events: none;
        }

        .flower-counter.show {
            opacity: 1;
        }

        .btn {
            background: linear-gradient(135deg, #A8E6CF, #DCEDC1);
            color: #4A6B5D; border: none;
            padding: 14px 36px;
            font-family: var(--font-stack);
            font-size: 15px; letter-spacing: 2px; font-weight: 300;
            cursor: pointer; border-radius: 50px;
            opacity: 0; transform: translateY(20px);
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            pointer-events: none;
            box-shadow: 0 10px 30px rgba(168, 230, 207, 0.25);
        }
        .btn:active { transform: scale(0.98) translateY(0); }
        .btn.visible { opacity: 1; transform: translateY(0); pointer-events: auto; }

        #poster-modal {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(248, 248, 246, 0.98);
            z-index: 100;
            display: none; flex-direction: column;
            align-items: center; justify-content: center;
            opacity: 0; transition: opacity 0.5s;
            padding: 20px;
        }
        #poster-modal.show { display: flex; opacity: 1; }
        #poster-img {
            max-width: 90%;
            max-height: 80vh; 
            object-fit: contain;
            box-shadow: 0 25px 50px rgba(0,0,0,0.08);
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .poster-info {
            text-align: center;
            max-width: 500px;
        }

        .poster-info p {
            font-size: 13px;
            color: #AAA;
            letter-spacing: 1px;
            margin: 10px 0;
        }

        .close-btn {
            margin-top: 20px;
            font-size: 28px;
            color: #CCC;
            cursor: pointer;
            padding: 10px;
            transition: color 0.3s;
        }

        .close-btn:hover {
            color: #999;
        }

        .music-control {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: rgba(168, 230, 207, 0.8);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 50;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(168, 230, 207, 0.3);
            opacity: 0;
            pointer-events: none;
        }

        .music-control.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .music-control:hover {
            background: rgba(168, 230, 207, 1);
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(168, 230, 207, 0.5);
        }

        .music-control svg {
            width: 24px;
            height: 24px;
            fill: #4A6B5D;
        }

        .music-control.muted {
            background: rgba(189, 189, 189, 0.8);
        }

        .music-control.muted:hover {
            background: rgba(189, 189, 189, 1);
        }
    </style>
</head>
<body>

<div id="app">
    <canvas id="mainCanvas"></canvas>

    <div class="ui-layer" id="uiLayer">
        <div class="hint-text" id="topHint">ËΩªËΩªËß¶Á¢∞<br>Áõ¥Èù¢Á†¥Á¢é</div>
        <button class="btn" id="generateBtn">ÁèçËóèËøôÂ∫ßËä±Âõ≠</button>
        <div class="flower-counter" id="flowerCounter"></div>
    </div>
</div>

<audio id="bgMusic" loop preload="auto">
    <source src="flower.mp3" type="audio/mpeg">
</audio>

<div class="music-control" id="musicControl">
    <svg id="musicIcon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/>
        <path d="M14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
    </svg>
    <svg id="mutedIcon" style="display:none;" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/>
    </svg>
</div>

<div id="choice-modal">
    <div class="choice-content">
        <div class="choice-title">
            2026Ôºå‰Ω†ÊÉ≥ÂíåË∞Å‰∏ÄËµ∑ÈáçÊñ∞ÂºÄÂßãÔºü
        </div>
        <div class="choice-subtitle">
            (ÂèØ‰ª•ÈÄâÊã©Â§ö‰∏™)
        </div>
        <div class="choice-buttons" id="choiceButtons"></div>
        <button class="choice-confirm-btn" id="confirmBtn" disabled>
            <svg class="btn-owl" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <!-- Ë∫´‰Ωì -->
                <ellipse cx="50" cy="65" rx="28" ry="32" fill="#C9A877"/>
                <!-- Â§¥ -->
                <circle cx="50" cy="38" r="26" fill="#C9A877"/>
                <!-- ËÇöÂ≠ê -->
                <ellipse cx="50" cy="68" rx="18" ry="24" fill="#F0DCC8"/>
                <!-- Â∑¶ËÄ≥Êúµ -->
                <ellipse cx="32" cy="18" rx="7" ry="12" fill="#C9A877"/>
                <ellipse cx="32" cy="20" rx="4" ry="8" fill="#F0DCC8"/>
                <!-- Âè≥ËÄ≥Êúµ -->
                <ellipse cx="68" cy="18" rx="7" ry="12" fill="#C9A877"/>
                <ellipse cx="68" cy="20" rx="4" ry="8" fill="#F0DCC8"/>
                <!-- Â∑¶ÁúºÁôΩ -->
                <ellipse cx="40" cy="35" rx="10" ry="12" fill="white"/>
                <!-- Âè≥ÁúºÁôΩ -->
                <ellipse cx="60" cy="35" rx="10" ry="12" fill="white"/>
                <!-- Â∑¶ÁúºÁû≥Â≠î -->
                <circle cx="40" cy="36" r="7" fill="#3D3D3D"/>
                <circle cx="42" cy="33" r="3" fill="white"/>
                <!-- Âè≥ÁúºÁû≥Â≠î -->
                <circle cx="60" cy="36" r="7" fill="#3D3D3D"/>
                <circle cx="62" cy="33" r="3" fill="white"/>
                <!-- Âò¥ -->
                <path d="M 50 48 Q 48 52 46 51" stroke="#D4A878" stroke-width="2" fill="none" stroke-linecap="round"/>
                <path d="M 50 48 Q 52 52 54 51" stroke="#D4A878" stroke-width="2" fill="none" stroke-linecap="round"/>
                <!-- ÈºªÂ≠ê -->
                <path d="M 50 44 L 48 46 L 50 47 L 52 46 Z" fill="#E8B88D"/>
                <!-- ÁøÖËÜÄÁ∫πÁêÜ -->
                <path d="M 25 50 Q 20 55 22 65" stroke="#A68B6F" stroke-width="2" fill="none" opacity="0.6"/>
                <path d="M 25 58 Q 20 62 22 70" stroke="#A68B6F" stroke-width="2" fill="none" opacity="0.6"/>
                <path d="M 75 50 Q 80 55 78 65" stroke="#A68B6F" stroke-width="2" fill="none" opacity="0.6"/>
                <path d="M 75 58 Q 80 62 78 70" stroke="#A68B6F" stroke-width="2" fill="none" opacity="0.6"/>
                <!-- Â∑¶ËÑö -->
                <path d="M 43 95 L 42 100 M 43 95 L 43 100 M 43 95 L 44 100" stroke="#D4A878" stroke-width="2" stroke-linecap="round"/>
                <!-- Âè≥ËÑö -->
                <path d="M 57 95 L 56 100 M 57 95 L 57 100 M 57 95 L 58 100" stroke="#D4A878" stroke-width="2" stroke-linecap="round"/>
            </svg>
            ÂíåÂΩíÂΩí‰∏ÄËµ∑ÁñóÊÑà
        </button>
    </div>
</div>

<div id="poster-modal">
    <img id="poster-img" src="" alt="Poster">
    <div class="poster-info">
        <p>‰Ω†ÁöÑËä±Âõ≠Áã¨‰∏ÄÊó†‰∫å</p>
        <p id="poster-time"></p>
        <p style="margin-top: 15px; color: #5FA894; font-weight: bold;">ËøôÊòØÊàëÁöÑÊ≤ªÊÑàÊó∂Âàª</p>
    </div>
    <div class="close-btn" onclick="closeModal()">√ó</div>
</div>

<script>
const CONFIG = {
    colors: {
        plate: '#FDFDFD', plateDark: '#EFEFEF',
        grassBg: '#E9F7EF',
        flowerWhite: '#FFFAF0', flowerCenterYellow: '#F0D89F',
        flowerPink: '#E8C5D8', flowerCenterPink: '#D997BD',
        leafGreen: '#A8E6CF', leafDark: '#7CC9A8',
        lavenderPurple: '#D5CDD8',
        lavenderDark: '#B5ADB8',
        tulipPink: '#D8A8C8',
        tulipGreen: '#8DB88D',
        pansyPurple: '#C8BDD5',
        pansyYellow: '#E8D8A8',
        sunflowerYellow: '#F5D891',
        sunflowerBrown: '#D4A76A',
        lilyWhite: '#F8F5F0',
        lilyYellow: '#F0E8A8',
        roseRed: '#E8B8C5',
        rosePink: '#F0C8D8',
        forgetMeNotBlue: '#B8D8E8',
        forgetMeNotCenter: '#F0E8A8',
        jasmineWhite: '#F8F8F0',
        jasmineYellow: '#F5F0C8',
        lilyOfValleyWhite: '#F5F8F5',
        lilyOfValleyGreen: '#C8E8C8'
    },
    physics: { friction: 0.90, stopThreshold: 0.05 }
};

const CHOICES = [
    'ÂíåËá™Â∑±ÈáçÊñ∞ÂºÄÂßã',
    'ÂíåÂ§±ÂéªÁöÑÂèãÊÉÖÈáçÊñ∞ÂºÄÂßã',
    'ÂíåÈÇ£‰∏™‰∫∫ÈáçÊñ∞ÂºÄÂßã',
    'ÂíåÊú™ÂÆûÁé∞ÁöÑÊ¢¶ÊÉ≥ÈáçÊñ∞ÂºÄÂßã',
    'ÂíåÂØπËá™Â∑±ÁöÑÊúüÂæÖÈáçÊñ∞ÂºÄÂßã',
    'ÂíåËøáÂéªÁöÑÈÅóÊÜæÈáçÊñ∞ÂºÄÂßã'
];

// ÁÆÄÂåñËØçÂ∫ìÔºöÊØè‰∏™‰∏ªÈ¢ò50Êù°Ôºà10-15Â≠óÔºâÔºåÊîØÊåÅ‰∏çÈáçÂ§çÂæ™ÁéØ
const MESSAGES_MAP = {
    'ÂíåËá™Â∑±ÈáçÊñ∞ÂºÄÂßã': [
        'ÂÖÅËÆ∏Ëá™Â∑±‰∏çÂÆåÁæéÔºåËøôÂ∞±ÊòØÊúÄÂ•ΩÁöÑÊàêÈïø',
        '‰Ω†ÂÄºÂæóË¢´Ê∏©ÊüîÂØπÂæÖÔºåÈ¶ñÂÖàÂØπËá™Â∑±',
        'Á†¥Á¢éÁöÑ‰Ω†‰æùÁÑ∂Èó™Èó™ÂèëÂÖâ',
        'ÊØè‰∏ÄÊ¨°ÊîæËøáËá™Â∑±ÈÉΩÊòØÊ∑±Ê∑±ÁöÑËá™Áà±',
        'ÊÖ¢ÊÖ¢Êù•Âà´ÊÄ•Ôºå‰Ω†Â∑≤ÁªèË∂≥Â§üÂ•Ω',
        'ÂØπËá™Â∑±ËØ¥‰∏ÄÂ£∞ÂØπ‰∏çËµ∑Ôºå‰πüË∞¢Ë∞¢‰Ω†',
        '‰Ω†ÁöÑÁº∫ÁÇπ‰πüÊòØÁã¨ÁâπÁöÑÊ†∑Â≠ê',
        'Â≠¶‰ºöÁà±Ëá™Â∑±ÊòØ‰Ω†Ëøô‰∏ÄÁîüÊúÄÈáçË¶ÅÂäüËØæ',
        'Êúâ‰∫õÊó∂ÂÄôÊîæ‰∏ãÂ∞±ÊòØÊúÄÂ•ΩÁöÑÂâçËøõ',
        'ÂéüË∞ÖËá™Â∑±ÂêßÔºåÂ∞±ÂÉèÂéüË∞ÖÊúÄ‰∫≤ËøëÁöÑ‰∫∫',
        '‰Ω†Ê≠£Âú®ÊÖ¢ÊÖ¢ÂèòÂº∫ÔºåÊØîÊò®Â§©Êõ¥ÂãáÊï¢',
        'ÂÅú‰∏ãÊù•‰ºëÊÅØ‰πüÊ≤°ÂÖ≥Á≥ªÔºåËøôÂ∞±ÊòØËá™Áà±',
        'Êé•Á∫≥‰∏çÂÆåÁæéÁöÑËá™Â∑±ÊòØ‰∏ÄÁßçÂäõÈáè',
        '‰Ω†ÁöÑÊïÖ‰∫ãËøòÊ≤°ÊúâÂÆåÁªìÔºåÊúÄÂ•ΩËøòÂú®',
        'ÊõæÁªèÁöÑ‰º§Â∑≤ÁªèÊàê‰∏∫‰Ω†ÁöÑÊô∫ÊÖß',
        'ÂÅöÁúüÂÆûÁöÑËá™Â∑±Â∞±Ë∂≥Â§ü‰∫Ü',
        'ÊàëÁúãÂà∞‰Ω†Âú®Âä™ÂäõÔºåËøôÁúüÁöÑÂ∞±Â§ü‰∫Ü',
        'Êúâ‰∫õÊîπÂèòÊòØÊÇÑÊÇÑÂèëÁîüÁöÑ',
        '‰Ω†ÁöÑÊØè‰∏ÄÊ≠•ÈÉΩÂú®ÊÖ¢ÊÖ¢Ê≤ªÊÑàËá™Â∑±',
        'ÂíåËá™Â∑±ÂíåÂπ≥Áõ∏Â§ÑÊòØÊúÄÂ§ßÁöÑËÉúÂà©',
        '‰Ω†ÂÄºÂæóË¢´Áà±ÔºåÂç≥‰ΩøÈÇ£‰∏™‰∫∫ÊòØ‰Ω†',
        'ÊõæËÆ©‰Ω†Âì≠Ê≥£ÁöÑ‰∫ã‰ºöËÆ©‰Ω†Á¨ëÁùÄËÆ≤Ëø∞',
        '‰Ω†Ê≠£Âú®Â≠¶‰ºöÂñÑÂæÖËá™Â∑±',
        'ÊúâÊó∂ÂÄô‰Ω†ÈúÄË¶ÅÁöÑÂ∞±ÊòØ‰∏ÄÂè•ÂæàÊ£í‰∫Ü',
        'Á†¥Á¢éÊïô‰∫Ü‰Ω†Â¶Ç‰ΩïÊ∏©ÊüîÂú∞ÊãºÂêà',
        '‰Ω†ÁöÑÁÅµÈ≠ÇÊØî‰ªª‰Ωï‰º§Âè£ÈÉΩÂùöÂº∫',
        'ÂÖÅËÆ∏Ëá™Â∑±Êàê‰∏∫‰∏Ä‰∏™Âú®ÊÑàÂêà‰∏≠ÁöÑ‰∫∫',
        '‰Ω†Â∑≤ÁªèÂú®ÊÖ¢ÊÖ¢ÂèòÊàêÊõ¥Â•ΩÁöÑÊ†∑Â≠ê',
        '‰ºëÊÅØ‰∏çÊòØÊîæÂºÉËÄåÊòØ‰∏∫‰∫ÜËµ∞ÂæóÊõ¥Ëøú',
        '‰Ω†‰∏çÁî®Êàê‰∏∫‰ªª‰Ωï‰∫∫ÂÅöËá™Â∑±Â∞±Ë∂≥Â§ü'
    ],
    'ÂíåÂ§±ÂéªÁöÑÂèãÊÉÖÈáçÊñ∞ÂºÄÂßã': [
        'Êúâ‰∫∫‰ºöÂõ†‰∏∫‰Ω†ÁöÑÁúüËØöËÄåÂõûÂà∞‰Ω†Ë∫´Ëæπ',
        'Â§±ÂéªÊïô‰ºö‰∫Ü‰Ω†‰ªÄ‰πàÊâçÊòØÁúüÊ≠£ÁèçË¥µ',
        '‰πüËÆ∏‰∏ã‰∏Ä‰∏™ÊúãÂèã‰ºöÊõ¥ÊáÇ‰Ω†',
        'Èô™‰º¥‰∏ç‰∏ÄÂÆöÊ∞∏Ëøú‰ΩÜÊõæÁªèÈÉΩÊòØÁúüÁöÑ',
        'ÂèãË∞äÁöÑË£ÇÁºùÈáå‰πüËÉΩÈïøÂá∫ÂÆΩÊÅï',
        '‰Ω†ÊúâËÉΩÂäõÂéªÁà±Â∞±ÊúâËÉΩÂäõÂéªÂéüË∞Ö',
        'Âèó‰º§ÂêéÁöÑ‰Ω†‰ºöÊõ¥Ê∏©ÊüîÂú∞ÂØπÂæÖ‰ªñ‰∫∫',
        '‰∏Ä‰∏™‰∫∫Ëµ∞‰πüÊ≤°ÂÖ≥Á≥ª‰ΩÜ‰Ω†Ê∞∏‰∏çÂ≠§Âçï',
        'Â§±Âéª‰∏çÊòØÁªàÁÇπËÄåÊòØÂè¶‰∏ÄÊÆµÂºÄÂßã',
        '‰Ω†ÁöÑÁúüÂøÉÂÄºÂæóË¢´ÁúãËßÅ',
        'ÈÇ£‰∫õÂÖ±ÂêåÂõûÂøÜÊ∞∏ËøúÈó™Èó™ÂèëÂÖâ',
        'ÊúâÊó∂ËÆ©ÂΩºÊ≠§Ëá™Áî±‰πüÊòØ‰∏ÄÁßçÁà±',
        '‰Ω†Â∑≤ÁªèË∂≥Â§üÂ•Ω‰∏çÁî®ÊîπÂèòÂéªÁïô‰Ωè',
        'ÊúãÂèãÊù•ÂæÄ‰ΩÜ‰Ω†ÁöÑ‰ª∑ÂÄºÊ∞∏‰∏çÊîπÂèò',
        'Êúâ‰∫õ‰∫∫Á¶ªÂºÄÊòØ‰∏∫‰∫ÜÊõ¥Â•ΩÁöÑ‰∫∫Âá∫Áé∞',
        '‰Ω†ÁöÑÈô™‰º¥ÂØπÊüê‰∏™‰∫∫Êù•ËØ¥ÊòØÊïëËµé',
        'Â§±ÂéªÊïô‰ºö‰∫Ü‰Ω†Â¶Ç‰ΩïÊõ¥Ê∑±Âú∞ÂéªÁà±',
        'Âç≥‰ΩøÂè™Êúâ‰Ω†‰πüÂèØ‰ª•Ëá™Â∑±Èô™‰º¥Ëá™Â∑±',
        'Êúâ‰∫õÂèãË∞äÊòØ‰∏ÄÁîüÊúâ‰∫õÊòØ‰∏Ä‰∏™Â≠£ËäÇ',
        '‰Ω†ÂÄºÂæóÊã•ÊúâÊ≤°ÊúâÊù°‰ª∂ÁöÑÂèãÊÉÖ',
        'Âì≠ËøáÁöÑÂ§úÊôöÈÉΩËÆ©‰Ω†ÂèòÂæóÊõ¥Âº∫',
        'Êúâ‰∫õ‰∫∫ËôΩ‰∏çÂú®‰ΩÜ‰ªñ‰ª¨Âú®‰Ω†ÂøÉÈáå',
        '‰Ω†ÁöÑÁúüÂøÉ‰∏ç‰ºöË¢´Êµ™Ë¥π',
        'Â§±ÂéªÁöÑÂêåÊó∂‰Ω†‰πüÂú®Ëé∑Âæó',
        'Êúâ‰∫õÂèãË∞äÂΩ¢ÂºèÊîπÂèòÊú¨Ë¥®Ê∞∏‰∏çÂèò',
        '‰Ω†Â∑≤ÁªèÂ≠¶‰ºö‰∫ÜÂ¶Ç‰ΩïÂéªÁà±',
        'ÊõæÁªèÁöÑÈô™‰º¥Ê∞∏ËøúÊòØ‰Ω†ÁöÑÂäõÈáè',
        'Êúâ‰∫∫Ê≠£Âú®Êüê‰∏™ËßíËêΩÊÉ≥Âøµ‰Ω†',
        '‰Ω†ÁöÑÊ∏©ÊüîÂÄºÂæóË¢´ÁèçÊÉú',
        'Â§±ÂéªËÆ©‰Ω†ÊòéÁôΩ‰ªÄ‰πàÊòØÁúüÊúãÂèã'
    ],
    'ÂíåÈÇ£‰∏™‰∫∫ÈáçÊñ∞ÂºÄÂßã': [
        'ËøôÊòØ‰∏∫‰∫ÜÂíåËß£‰∏éÈáçÁîüËÄåÂºÄÁöÑËä±',
        'ÂéüË∞ÖÊòØÁªôËá™Â∑±ÊúÄÂ•ΩÁöÑÁ§ºÁâ©',
        '‰Ω†ÂÄºÂæóË¢´Áà±Âç≥‰ΩøËøô‰∏ÄÊ¨°‰∏çÊòØ‰ªñ',
        'Êúâ‰∫∫Áúã‰∏çÊáÇ‰Ω†ÁöÑ‰ª∑ÂÄº‰∏çÊòØ‰Ω†ÁöÑÈîô',
        '‰∏ã‰∏ÄÊÆµÊïÖ‰∫ã‰ºöÊúâ‰∫∫ÁèçÊÉú‰Ω†ÁöÑÂÖ®ÈÉ®',
        'Áà±ËøáÂ∞±Ë∂≥Â§ü‰∫ÜÂà´ÂÜç‰∏∫Ê≠§ËãõË¥£Ëá™Â∑±',
        'ÊîæÊâã‰πüÊòØ‰∏ÄÁßçÊ∑±Ê∑±ÁöÑÁà±',
        '‰Ω†ÁöÑÊ∏©Êüî‰ºöÂú®Âà´Â§ÑË¢´ÁúãËßÅ',
        'Êúâ‰∫õ‰∫∫Ê≥®ÂÆöÂè™ÊòØÁîüÂëΩ‰∏≠ÁöÑËøáÂÆ¢',
        '‰Ω†ÁöÑÁà±‰∏çÊòØÊµ™Ë¥πÂÆÉÊîπÂèò‰∫Ü‰Ω†',
        'Á¶ªÂºÄ‰∏çÂõ†‰Ω†‰∏çÂ§üÂ•ΩÊòØÂõ†‰Ω†ÂÄºÂæóÊõ¥Â•Ω',
        'ÈÇ£‰∫õÁúºÊ≥™ÈÉΩÊªãÂÖª‰∫Ü‰Ω†ÁöÑÁÅµÈ≠Ç',
        'ÊúâÊó∂Â§±ÂéªÊüê‰∏™‰∫∫ÊâçËÉΩÊâæÂà∞Ëá™Â∑±',
        '‰Ω†ÁöÑÁúüÂøÉÂÄºÂæóË¢´‰∏Ä‰∏™ÁúüÁöÑÁèçÊÉú',
        'ÂíåËß£ÂèØ‰ª•‰ªéÊîæÊâãÂºÄÂßã',
        '‰ªñÁúã‰∏çËßÅ‰Ω†ÁöÑÂ•ΩÊòØ‰ªñÁöÑÈÅóÊÜæ',
        'Êúâ‰∫õÁà±Ê≥®ÂÆöÊòØ‰∏Ä‰∏™‰∫∫ÁöÑÂäüËØæ',
        '‰Ω†Â∑≤Ë∂≥Â§üÂä™ÂäõÊòØÊó∂ÂÄô‰∏∫Ëá™Â∑±Ê¥ª',
        'Áà±ÊÉÖ‰∏çÊòØÊïëËµéÊòØ‰∏§‰∏™‰∫∫ÁöÑÈÄâÊã©',
        '‰Ω†ÂÄºÂæóË¢´ÈÄâÊã©ËÄå‰∏çÊòØË¢´Ëø´Á≠âÂæÖ',
        'ÂØπ‰ªñÁöÑÊÄùÂøµ‰ºöÊÖ¢ÊÖ¢ÂèòÊàêÂØπËá™Â∑±ÁöÑÁà±',
        'Êúâ‰∫∫‰∏çÊáÇ‰Ω†ÁöÑÊâßÁùÄ‰ΩÜ‰∏ç‰ª£Ë°®ÊúâÈîô',
        'ÊîæÊâãÁöÑ‰∫∫ÂæÄÂæÄÊúÄÂãáÊï¢',
        '‰Ω†ÁöÑÁà±ÂÄºÂæóË¢´Á≠â‰ª∑Âú∞ÂõûÂ∫î',
        'ÊúâÊó∂ÊúÄÂ•ΩÁöÑÁà±Â∞±ÊòØÊîæÂºÄ',
        'Ê≤°ÊúâÂõûÈü≥ÁöÑÂëºÂî§Êïô‰ºö‰Ω†Áã¨Á´ã',
        '‰Ω†‰∏çÁî®ÊîπÂèòËá™Â∑±ÂéªÁ¨¶ÂêàË∞ÅÁöÑÊúüÂæÖ',
        'Êúâ‰∫õ‰∫∫Âè™ÊòØÈÄî‰∏≠ÁöÑÈÇÇÈÄÖ‰∏çÊòØÁªàÁÇπ',
        '‰Ω†ÁöÑÁÉ≠ÊÉÖÊó©Êôö‰ºöÈÅáËßÅÂõûÂ∫î',
        'Á¶ªÂºÄÁöÑÁóõÊòØÊàêÈïøÁöÑ‰ª£‰ª∑'
    ],
    'ÂíåÊú™ÂÆûÁé∞ÁöÑÊ¢¶ÊÉ≥ÈáçÊñ∞ÂºÄÂßã': [
        'Ê¢¶ÊÉ≥ÁöÑË∑ØÂæàÈïø‰Ω†ËøòÊúâÂ§™Â§öÁöÑÊó∂Èó¥',
        'ÊîπÂèòÊñπÂêëÊâçÊòØÁúüÊ≠£ÁöÑÊô∫ÊÖß',
        '‰Ω†Â∑≤ÁªèÊØîÊò®Â§©Êõ¥Êé•ËøëÊ¢¶ÊÉ≥‰∫Ü',
        'ÊØè‰∏ÄÊ¨°Â∞ùËØïÈÉΩÂú®Â°ëÈÄ†Êõ¥Â•ΩÁöÑ‰Ω†',
        'Ê¢¶ÊÉ≥‰ºöÁ≠â‰Ω†ÂèØËÉΩ‰ª•‰∏çÂêåÁöÑÂΩ¢Âºè',
        'Â§±Ë¥•ÁöÑÁªèÂéÜÊòØÊ¢¶ÊÉ≥ÂøÖÈ°ªÁöÑÈì∫Âû´',
        'ÂÖÅËÆ∏Ëá™Â∑±Ë∞ÉÊï¥ÊñπÂêëËøôÂè´ÂÅöÊàêÈïø',
        'Ëøô‰∏ÄÂàªÁöÑÊîæ‰∏ãÊòØ‰∏∫‰∫ÜÊõ¥Â•ΩÁöÑÂá∫Âèë',
        'Êúâ‰∫õÊ¢¶ÊÉ≥ÈúÄË¶ÅÊó∂Èó¥‰ΩÜ‰Ω†ÊúâÁöÑÊòØÊó∂Èó¥',
        'Ê≤°ÊúâËµ∞ÂºØË∑ØÁöÑ‰∫∫‰ªé‰∏ç‰ºöÂà∞ËææËøúÊñπ',
        '‰Ω†ÁöÑÊ¢¶ÊÉ≥Âú®Á≠â‰Ω†Êõ¥ÊàêÁÜüÁöÑËá™Â∑±',
        'Â§±Ë¥•Âè™ÊòØÊ¢¶ÊÉ≥ÁöÑÂè¶‰∏ÄÁßçÂºÄÂßã',
        '‰∏çÈ°∫Âà©ÁöÑÊó•Â≠êÈÉΩÂú®Êïô‰Ω†‰ªÄ‰πàÂùöÊåÅ',
        'Ê¢¶ÊÉ≥‰∏ç‰ºöÂò≤Á¨ëÂ§±Ë¥•Âè™Êã•Êä±ÊàêÈïø',
        'ÊúâÊó∂ÊúÄÂ•ΩÁöÑËÆ°ÂàíÊòØÂÖÅËÆ∏ÊîπÂèò',
        '‰Ω†Â∑≤ÁªèÂú®ËøΩÊ¢¶ÁöÑË∑Ø‰∏ä‰∫ÜÂæàËÉúÂà©',
        'ÈÇ£‰∫õÊå´ÊäòÈÉΩÊòØÊ¢¶ÊÉ≥ÁïôÁªô‰Ω†ÁöÑÁ§ºÁâ©',
        'ÂùöÊåÅÊòØ‰∏ÄÁßçËÉΩÂäõ‰Ω†Ê≠£Âú®Â≠¶‰ºö',
        'Êúâ‰∫õÊ¢¶ÊÉ≥Ê≥®ÂÆöË¶ÅËµ∞Êõ≤ÊäòÁöÑË∑Ø',
        '‰Ω†Ê≤°ÊúâÂ§±Ë¥•‰Ω†Âè™ÊòØÂú®ÊâæÊñπÂêë',
        'Ê¢¶ÊÉ≥ÁöÑÁÅ´ÁÑ∞Âú®‰Ω†ÂøÉÈáåÊ∞∏‰∏çÁÜÑÁÅ≠',
        'ÊúâÊó∂Á≠âÂæÖ‰πüÊòØ‰∏ÄÁßçÂä™Âäõ',
        '‰Ω†ÂÄºÂæóÊã•ÊúâÈÇ£‰∏™Ê¢¶ÊÉ≥ÁöÑËá™Â∑±',
        'Ê≤°ÊúâÁôΩËµ∞ÁöÑË∑ØÊØè‰∏ÄÊ≠•ÈÉΩÈù†Ëøë',
        'Â§±Ë¥•Êïô‰ºö‰Ω†‰Ωï‰∏∫ÁúüÊ≠£ÁöÑÊ¢¶ÊÉ≥',
        'Êúâ‰∫õÊàêÂäüÈúÄË¶ÅÂÖàÁªèÂéÜÂá†Ê¨°Â§±Ë¥•',
        '‰Ω†ÁöÑÊ¢¶ÊÉ≥Ê≠£Âú®‰Ω†ÁöÑÊØè‰∏™ÈÄâÊã©‰∏≠',
        'ÂùöÊåÅ‰∏çÊòØÂõ∫ÊâßËÄåÊòØ‰ø°Âøµ',
        'ÈÇ£‰∫õÊõæÁúã‰∏çÊ∏ÖÁöÑË∑ØÁé∞Âú®ÂèòÊ∏ÖÊô∞',
        'Êúâ‰∫∫ÊîæÂºÉ‰ΩÜ‰Ω†Âú®ÂùöÊåÅËøôÊòØÂå∫Âà´'
    ],
    'ÂíåÂØπËá™Â∑±ÁöÑÊúüÂæÖÈáçÊñ∞ÂºÄÂßã': [
        '‰Ω†‰∏çÈúÄË¶ÅÂÆåÁæéÂè™ÈúÄË¶ÅÁúüÂÆû',
        'ËøôÊòØ‰∏ÄÊúµÊîæËøáËá™Â∑±ÁöÑËä±',
        'ÊúüÂæÖÂ§™È´ò‰πüÊòØ‰∏ÄÁßçÂØπËá™Â∑±ÁöÑ‰º§ÂÆ≥',
        '‰Ω†Â∑≤ÁªèÂÅöÂæóÂæàÂ•Ω‰∫ÜËØ∑Áõ∏‰ø°Ëá™Â∑±',
        'Êàê‰∏∫ÊúÄÂ•ΩÁöÑËá™Â∑±‰∏çÊòØÂà´‰∫∫ÁúºÈáåËá™Â∑±',
        'ËøõÊ≠•‰∏çÊòØ‰∏ÄÊù°Áõ¥Á∫øÂÖÅËÆ∏Ëá™Â∑±ËøÇÂõû',
        'Êúâ‰∫õÊúüÂæÖÈúÄË¶ÅÊîæ‰∏ãÊâçËÉΩÁúüÊ≠£Âø´‰πê',
        '‰Ω†ÁöÑ‰ª∑ÂÄº‰∏çÁî±ÊúüÂæÖÊù•ÂÆö‰πâ',
        'ËøôÊúµËä±‰∏∫‰∫ÜÊé•Á∫≥‰∏çÂÆåÁæéÁöÑËá™Â∑±',
        'ÂÆåÁæéÂè™Â≠òÂú®ÊúüÂæÖ‰∏≠‰∏çÂ≠òÂú®ÁîüÊ¥ªÈáå',
        '‰Ω†Â∑≤ÁªèÂ§üÂ•Ω‰∫Ü‰∏çÁî®ÂÜçËøΩÊ±ÇÊõ¥Â•Ω',
        'Êúâ‰∫õÊúüÂæÖÊòØÂà´‰∫∫ÁöÑÊ¢¶‰∏çÊòØ‰Ω†ÁöÑ',
        'Êîæ‰∏ãÊâßÂøµÂ∞±ÊòØÊîæËøáËá™Â∑±',
        '‰Ω†ÁöÑÊØè‰∏Ä‰∏™Áº∫ÁÇπÈÉΩÊòØÁã¨Áâπ',
        'ÊúüÂæÖË∂äÂ§öÂ§±ÊúõÂ∞±Ë∂äÂ§ß',
        'ÊúâÊó∂Êé•Á∫≥Ëá™Â∑±Â∞±ÊòØÊúÄÂ§ßÁöÑÊàêÂ∞±',
        '‰Ω†‰∏çÁî®Êàê‰∏∫‰ªª‰Ωï‰∫∫ÁöÑÊ†áÊùÜ',
        'ÈÇ£‰∫õÊú™ËææÊàêÁöÑÊúüÂæÖÊïô‰Ω†Êîæ‰∏ã',
        'ÁúüÂÆûÁöÑ‰Ω†ÊØîÂÆåÁæéÁöÑÂπªÊÉ≥Êõ¥ÂÄºÁà±',
        'ÊúâÊó∂ÂÅúÊ≠¢ÊØîËæÉÂ∞±ÊòØËá™ÊàëÊïëËµé',
        '‰Ω†Ê≠£Âú®Â≠¶‰ºö‰∏éËá™Â∑±ÂíåÂπ≥Áõ∏Â§Ñ',
        'ÊúüÂæÖÁöÑÁºùÈöôÈáåË£ÖÁùÄÂ§™Â§öÈÅóÊÜæ',
        '‰Ω†Â∑≤Ë∂≥Â§üÂä™ÂäõÊòØÊó∂ÂÄôÁúãÈó™ÂÖâ',
        '‰∏çÁî®‰∫ã‰∫ãÂ∞ΩÂäõÊúâÊó∂Âπ≥Âá°Â∞±Â•Ω',
        '‰Ω†ÁöÑÊ†∑Â≠êÂàöÂàöÂ•Ω',
        'ÊúüÂæÖ‰ºöÁªô‰Ω†ÂéãÂäõ‰ΩÜ‰Ω†ÂÄºËá™Âú®',
        'ÊúâÊó∂Â§±Ë¥•ÂèçËÄåËÆ©‰Ω†ÁúãÊ∏ÖËá™Â∑±',
        '‰Ω†Â∑≤Âú®ÊÖ¢ÊÖ¢Êîæ‰∏ãÈÇ£‰∫õ‰∏çÂøÖË¶Å',
        'Êé•Á∫≥Ëá™Â∑±ÊòØÊúÄÊ∏©ÊüîÁöÑËá™Áà±',
        'ÊúâÊó∂‰∏çÂèäÊ†ºÁöÑ‰∫∫Áîü‰πüÂæàÁ≤æÂΩ©'
    ],
    'ÂíåËøáÂéªÁöÑÈÅóÊÜæÈáçÊñ∞ÂºÄÂßã': [
        'ÈÅóÊÜæÊòØ‰∫∫ÁîüÁöÑ‰∏ÄÈÉ®ÂàÜ‰πüÊòØÂäõÈáèÊù•Ê∫ê',
        'ËøôÊòØ‰∏ÄÊúµ‰∏éËøáÂéªÂíåËß£ÁöÑËä±',
        'ËøáÂéªÂ∑≤ÁªèËøáÂéª‰Ω†ËøòÊúâÊï¥‰∏™Êú™Êù•',
        'ÈÅóÊÜæÊïô‰ºö‰Ω†‰ªÄ‰πàÊâçÊòØÁúüÊ≠£ÁöÑÁèçÊÉú',
        'ÈÇ£‰∫õÈîôËØØËÆ©‰Ω†Êàê‰∏∫‰∫ÜÁé∞Âú®ÁöÑËá™Â∑±',
        'ÂéüË∞ÖËøáÂéªÁöÑËá™Â∑±ÊâçËÉΩÊã•Êä±Êú™Êù•',
        'ÊØè‰∏Ä‰∏™ÈÅóÊÜæÈÉΩÊòØÊàêÈïøÁöÑËØÅÊòé',
        '‰Ω†‰∏çËÉΩÊîπÂèòËøáÂéª‰ΩÜËÉΩÊîπÂèòÁúãÊ≥ï',
        'ËøôÊúµËä±ÁõõÂºÄÂú®ÈÅóÊÜæÁöÑÂÖªÂàÜÈáå',
        'Êúâ‰∫õ‰∫ãÊ≤°ÂÅöÊàêÂ∞±‰∫ÜÂè¶‰∏Ä‰∫õÂèØËÉΩ',
        'ÈÅóÊÜæ‰∏çÊòØÂ§±Ë¥•ÊòØÈÄâÊã©ÁöÑ‰ª£‰ª∑',
        '‰Ω†Â∑≤ÁªèÁî®Ë°åÂä®Âº•Ë°•‰∫ÜÊõæÁªèÈÅóÊÜæ',
        'ËøáÂéªÁöÑËá™Â∑±Â∑≤ÁªèÂ∞ΩÂäõ‰∫Ü',
        'ÈÇ£‰∫õÊ≤°ËØ¥ÁöÑËØùÁé∞Âú®ÂèØ‰ª•ÂØπËá™Â∑±ËØ¥',
        'ÊúâÊó∂ÈÅóÊÜæÊâçÊòØ‰∫∫ÁîüÊúÄÂ•ΩÁöÑËÄÅÂ∏à',
        '‰Ω†Êó†Ê≥ïÈáçÊù•‰ΩÜÂèØ‰ª•ÈáçÊñ∞ÂºÄÂßã',
        'ÈÇ£‰∫õÊõæÁªèÁöÑÈîôËØØÈÉΩËÆ©‰Ω†Êõ¥Êô∫ÊÖß',
        'ÈÅóÊÜæËÆ©‰Ω†ÊáÇÂæó‰∫Ü‰ªÄ‰πàÂè´ÁèçÊÉú',
        '‰Ω†Â∑≤ÁªèÂú®ÊÖ¢ÊÖ¢ÂéüË∞ÖËøáÂéªÁöÑËá™Â∑±',
        'Êúâ‰∫õ‰∫ãÊ≤°ÂÅöÊÅ∞Â•ΩÊòØÊúÄÂ•ΩÁöÑÂÆâÊéí',
        'ËøáÂéªÊó†Ê≥ïÊîπÂÜô‰ΩÜ‰Ω†ÂèØÊîπÂÜôÊú™Êù•',
        'ÈÇ£‰∫õÈÅóÊÜæÂÖ∂ÂÆûÈÉΩÊúâ‰∫ÜÁ≠îÊ°à',
        '‰Ω†ÂÄºÂæóÂéüË∞ÖËá™Â∑±ÊõæÁªèÁöÑÊó†Áü•',
        'ÈÅóÊÜæÁöÑËÉåÂêéÂæÄÂæÄÊòØÊõ¥Â•ΩÁöÑÁªìÊûú',
        'ÊúâÊó∂ÈîôËøáÊâçËÉΩËÆ©‰Ω†ÈÅáËßÅÂØπÁöÑ',
        '‰Ω†Â∑≤‰∏∫ËøáÂéªÁöÑÈÄâÊã©‰ªòÂá∫‰ª£‰ª∑',
        'ÈÇ£‰∫õ‰∏çÂÆåÁæéÁöÑËøáÂéªÂ°ëÈÄ†Áé∞Âú®',
        'Êúâ‰∫õÈÅóÊÜæÂè™ÊúâÊó∂Èó¥ÊâçËÉΩÊ≤ªÊÑà',
        '‰Ω†Ê≠£Âú®Â≠¶‰ºö‰∏éÈÅóÊÜæÂÖ±Â§Ñ',
        'ËøôÊúµËä±ËßÅËØÅ‰∫Ü‰Ω†‰∏éËøáÂéªÁöÑÂíåËß£'
    ]
};

// ‰∏∫ÊØè‰∏™ÈÄâÊã©Áª¥Êä§Â∑≤ÊòæÁ§∫ËØçÂ∫ìÁöÑÁ¥¢Âºï
let displayedIndices = {};

// Ë∑üË∏™Â∑≤ÁªèÂá∫Áé∞ËøáÁöÑËä±ÊúµÁ±ªÂûã
let appearedFlowerTypes = new Set();

// Ëä±ÊúµÂêçÁß∞ÂíåË±°ÂæÅÊÑè‰πâ
const FLOWER_MEANINGS = [
    { name: 'ÈõèËèä', meaning: 'Á∫ØÁúü‰∏éÂ∏åÊúõ' },
    { name: 'Ê®±Ëä±', meaning: 'ÁèçÊÉúÂΩì‰∏ã' },
    { name: '‰∏âÂè∂Ëçâ', meaning: 'Âπ∏Ëøê‰∏éÁ•ùÁ¶è' },
    { name: 'Ëñ∞Ë°£Ëçâ', meaning: 'ÂÆÅÈùô‰∏éÊ≤ªÊÑà' },
    { name: 'ÈÉÅÈáëÈ¶ô', meaning: 'ÁæéÂ•Ω‰∏éÁ•ùÁ¶è' },
    { name: '‰∏âËâ≤Â†á', meaning: 'ÊÄùÂøµ‰∏éÂõûÂøÜ' },
    { name: 'ÂêëÊó•Ëëµ', meaning: 'Èò≥ÂÖâ‰∏éÂãáÊ∞î' },
    { name: 'ÁôæÂêà', meaning: 'Á∫ØÊ¥Å‰∏éÈáçÁîü' },
    { name: 'Áé´Áë∞', meaning: 'Áà±‰∏éÂùöÂº∫' },
    { name: 'ÂãøÂøòÊàë', meaning: 'Ê∞∏ÊÅíÁöÑËÆ∞ÂøÜ' },
    { name: 'ËåâËéâËä±', meaning: 'Ê∏©Êüî‰∏éÁ∫ØÁúü' },
    { name: 'ÈìÉÂÖ∞', meaning: 'Âπ∏Á¶èÂΩíÊù•' }
];

function initDisplayedIndices() {
    CHOICES.forEach(choice => {
        displayedIndices[choice] = new Set();
    });
}

function getRandomMessage() {
    if(selectedChoices.length === 0) return 'üå∏';
    const choice = selectedChoices[Math.floor(Math.random() * selectedChoices.length)];
    const messages = MESSAGES_MAP[choice] || [];

    if(messages.length === 0) return 'ËøôÊúµËä±‰∏∫‰Ω†ËÄåÂºÄ';

    // Ëé∑ÂèñËøòÊú™ÊòæÁ§∫ËøáÁöÑÁ¥¢Âºï
    const displayed = displayedIndices[choice];
    const availableIndices = [];
    for(let i = 0; i < messages.length; i++) {
        if(!displayed.has(i)) {
            availableIndices.push(i);
        }
    }

    // Â¶ÇÊûúÊâÄÊúâËØçÈÉΩÊòæÁ§∫Ëøá‰∫ÜÔºåÈáçÁΩÆ
    if(availableIndices.length === 0) {
        displayed.clear();
        for(let i = 0; i < messages.length; i++) {
            availableIndices.push(i);
        }
    }

    // ÈöèÊú∫ÈÄâÊã©‰∏ÄÊù°Êú™ÊòæÁ§∫ÁöÑËØç
    const randomIdx = availableIndices[Math.floor(Math.random() * availableIndices.length)];
    displayed.add(randomIdx);

    return messages[randomIdx];
}

function getSpecialMessage(flowerType) {
    const flower = FLOWER_MEANINGS[flowerType];
    const templates = [
        `‚ú® ‰∏ÄÊúµ${flower.name}‰∏∫‰Ω†ÁªΩÊîæÔºåÂ∏¶Êù•${flower.meaning}`,
        `‚ú® ${flower.name}ÊÇÑÊÇÑÂºÄ‰∫ÜÔºåÊÑø‰Ω†Êã•Êúâ${flower.meaning}`,
        `‚ú® ÁúãÔºå${flower.name}Âú®ÂØπ‰Ω†ÂæÆÁ¨ëÔºåÂÆÉ‰ª£Ë°®${flower.meaning}`,
        `‚ú® ËøôÊúµ${flower.name}ÈÄÅÁªô‰Ω†ÔºåÊÑø${flower.meaning}Â∏∏‰º¥Â∑¶Âè≥`,
        `‚ú® ${flower.name}ÁõõÂºÄ‰∫ÜÔºåÂ∏¶ÁùÄ${flower.meaning}ÁöÑÁ•ùÁ¶è`,
        `‚ú® ÈÅáËßÅ‰∏ÄÊúµ${flower.name}ÔºåÈÅáËßÅ${flower.meaning}`,
        `‚ú® ${flower.name}‰∏∫‰Ω†ËÄåÂºÄÔºåÂØìÊÑè${flower.meaning}`,
        `‚ú® ËøôÊòØ${flower.name}ÔºåËΩªËΩªËØâËØ¥ÁùÄ${flower.meaning}`,
        `‚ú® ‰∏ÄÊúµÁâπÂà´ÁöÑ${flower.name}ÔºåÊâøËΩΩ${flower.meaning}ÁöÑÂøÉÊÑè`,
        `‚ú® ${flower.name}Âú®Ê≠§ÂàªÁªΩÊîæÔºåË±°ÂæÅ${flower.meaning}`,
        `‚ú® ÊÑøËøôÊúµ${flower.name}Â∞Ü${flower.meaning}Â∏¶Áªô‰Ω†`,
        `‚ú® ${flower.name}Ê∏©ÊüîÂú∞ÂºÄÁùÄÔºåÂØÑ‰∫à${flower.meaning}ÁöÑÊúüËÆ∏`
    ];
    return templates[Math.floor(Math.random() * templates.length)];
}

const FEEDBACKS = {
    break: 'ÊÑüÂèóÂà∞‰Ω†‰∫Ü',
    flower1: 'Á¨¨‰∏ÄÊúµÂ∏åÊúõ',
    flower3: 'ÁîüÂëΩÂú®ËãèÈÜí',
    flower5: '‰Ω†ÂÅöÂæàÊ£í'
};

const STATE = { CHOICE: -1, IDLE: 0, BROKEN: 1, GARDENING: 2 };
let currentState = STATE.CHOICE;
let selectedChoices = [];
let width, height, centerX, centerY;
let shards = [];
let flowers = [];
let dpr = window.devicePixelRatio || 2;
const canvas = document.getElementById('mainCanvas');
const ctx = canvas.getContext('2d');
const hintText = document.getElementById('topHint');
const counterEl = document.getElementById('flowerCounter');

class Shard {
    constructor(c, as, ae, e1, e2, r) {
        this.centerOrigin={...c}; this.r=r; this.x=c.x; this.y=c.y;
        this.rot=0; this.vx=0; this.vy=0; this.vr=0;
        this.as=as; this.ae=ae; this.e1=e1; this.e2=e2;
        this.breatheOffset = Math.random() * Math.PI * 2; // ÂëºÂê∏Áõ∏‰ΩçÂÅèÁßª
    }
    
    explode() { 
        const m=(this.as+this.ae)/2; 
        const baseForce = Math.min(width, height) * 0.015; 
        const f = baseForce * (0.8 + Math.random() * 0.4); 
        this.vx=Math.cos(m)*f; 
        this.vy=Math.sin(m)*f; 
        this.vr=(Math.random()-0.5)*0.05;
    }
    
    update() { 
        if(currentState===STATE.BROKEN){ 
            this.x+=this.vx; this.y+=this.vy; this.rot+=this.vr; 
            this.vx*=CONFIG.physics.friction; this.vy*=CONFIG.physics.friction; this.vr*=CONFIG.physics.friction; 
            return (Math.abs(this.vx)<CONFIG.physics.stopThreshold&&Math.abs(this.vy)<CONFIG.physics.stopThreshold); 
        } 
        return true; 
    }

    draw(ctx) {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.rot);

        // ÂæÆÂ¶ôÁöÑÂëºÂê∏ÊïàÊûúÔºö0.98 - 1.02 ‰πãÈó¥ÁöÑÁº©Êîæ
        const breatheScale = 1 + Math.sin(Date.now() / 3000 + this.breatheOffset) * 0.02;
        ctx.scale(breatheScale, breatheScale);

        ctx.beginPath();
        const r = this.r;
        const c = 15;
        const dl = (a, n, rev) => {
            for(let i = (rev ? c : 0); rev ? i >= 0 : i <= c; rev ? i-- : i++) {
                const d = (i / c) * r;
                const off = (n[i - (rev ? 0 : 1)] || 0) * (r * 0.04);
                ctx.lineTo(Math.cos(a) * d + Math.cos(a + Math.PI / 2) * off, Math.sin(a) * d + Math.sin(a + Math.PI / 2) * off);
            }
        };
        dl(this.as, this.e1, false);
        ctx.arc(0, 0, r, this.as, this.ae);
        dl(this.ae, this.e2, true);
        ctx.closePath();
        const g = ctx.createRadialGradient(0, 0, 0, 0, 0, r);
        g.addColorStop(0, '#FFF');
        g.addColorStop(1, CONFIG.colors.plateDark);
        ctx.fillStyle = g;
        ctx.shadowColor = 'rgba(0,0,0,0.06)';
        ctx.shadowBlur = 15;
        ctx.shadowOffsetY = 8;
        ctx.fill();
        ctx.restore();
    }
}

class Flower {
    constructor(x,y) {
        this.x=x; this.y=y; this.s=0; this.ts=0.4+Math.random()*0.5;
        this.rot=Math.random()*Math.PI*2;
        this.t=Math.floor(Math.random()*12); // 12ÁßçËä±Êúµ
        this.wo=Math.random()*100;

        // ÂèòÊØîÂº∫ÂåñÔºöÁ∫¶10%Ê¶ÇÁéáÂá∫Áé∞ÁâπÊÆäËä±Êúµ
        this.isSpecial = Math.random() < 0.10;

        if(this.isSpecial) {
            // ÁâπÊÆäËä±ÊúµÔºöÊõ¥Â§ß„ÄÅÊõ¥ÁÅøÁÉÇ‰ΩÜ‰ΩéË∞É
            this.size = 1.6 + Math.random() * 0.4; // 1.6-2ÂÄçÂ§ßÂ∞è
            this.glow = true;
            this.glowPhase = 0;
            this.glowIntensity = 0.4; // ÊüîÂíåÁöÑÂÖâÊôï
        } else {
            this.glow = Math.random() < 0.15;
            this.glowPhase = 0;
            this.size = 0.8 + Math.random() * 0.6;
            this.glowIntensity = 0.3;
        }
    }

    update() {
        this.s+=(this.ts-this.s)*0.15;
        if(this.glow) this.glowPhase = (this.glowPhase + 0.05) % (Math.PI * 2);
    }

    draw(ctx) {
        ctx.save(); ctx.translate(this.x,this.y);
        const w=Math.sin(Date.now()/500+this.wo)*0.05; ctx.rotate(this.rot+w);
        ctx.scale(this.s * this.size, this.s * this.size);

        if(this.glow) {
            const glowOpacity = Math.sin(this.glowPhase) * this.glowIntensity + this.glowIntensity;
            if(this.isSpecial) {
                // ÁâπÊÆäËä±ÊúµÔºöÊ∏©ÊöñÁöÑÈáëÁ≤âËâ≤ÂÖâÊôïÔºå‰ΩéË∞ÉÊ≤ªÊÑà
                ctx.shadowColor = `rgba(255, 230, 200, ${glowOpacity})`;
                ctx.shadowBlur = 35;
            } else {
                ctx.shadowColor = `rgba(255, 215, 0, ${glowOpacity})`;
                ctx.shadowBlur = 20;
            }
        }

        if(this.t===0)this.dDaisy(ctx);
        else if(this.t===1)this.dSakura(ctx);
        else if(this.t===2)this.dClover(ctx);
        else if(this.t===3)this.dLavender(ctx);
        else if(this.t===4)this.dTulip(ctx);
        else if(this.t===5)this.dPansy(ctx);
        else if(this.t===6)this.dSunflower(ctx);
        else if(this.t===7)this.dLily(ctx);
        else if(this.t===8)this.dRose(ctx);
        else if(this.t===9)this.dForgetMeNot(ctx);
        else if(this.t===10)this.dJasmine(ctx);
        else this.dLilyOfValley(ctx);
        ctx.restore(); 
    }

    dDaisy(ctx) { 
        ctx.fillStyle=CONFIG.colors.flowerWhite; 
        for(let i=0;i<8;i++){
            ctx.beginPath();
            ctx.rotate(Math.PI*2/8);
            ctx.ellipse(15,0,10,5,0,0,Math.PI*2);
            ctx.fill();
        } 
        ctx.beginPath();
        ctx.arc(0,0,8,0,Math.PI*2);
        ctx.fillStyle=CONFIG.colors.flowerCenterYellow;
        ctx.fill();
        ctx.shadowColor='rgba(255, 215, 0, 0.2)';
        ctx.shadowBlur=15;
    }

    dSakura(ctx) { 
        ctx.fillStyle=CONFIG.colors.flowerPink; 
        for(let i=0;i<5;i++){
            ctx.beginPath();
            ctx.rotate(Math.PI*2/5);
            ctx.moveTo(0,0);
            ctx.quadraticCurveTo(10,-10,20,0);
            ctx.quadraticCurveTo(10,10,0,0);
            ctx.fill();
        } 
        ctx.beginPath();
        ctx.arc(0,0,5,0,Math.PI*2);
        ctx.fillStyle=CONFIG.colors.flowerCenterPink;
        ctx.fill();
        ctx.shadowColor='rgba(255, 105, 180, 0.2)';
        ctx.shadowBlur=15;
    }

    dClover(ctx) { 
        ctx.fillStyle=CONFIG.colors.leafGreen; 
        ctx.beginPath();
        ctx.ellipse(-8,-5,12,6,Math.PI/4,0,Math.PI*2);
        ctx.fill(); 
        ctx.beginPath();
        ctx.ellipse(8,-5,12,6,-Math.PI/4,0,Math.PI*2);
        ctx.fill(); 
        ctx.strokeStyle=CONFIG.colors.leafDark;
        ctx.lineWidth=2;
        ctx.lineCap='round';
        ctx.beginPath();
        ctx.moveTo(0,0);
        ctx.quadraticCurveTo(0,10,-2,20);
        ctx.stroke();
        ctx.shadowColor='rgba(168, 230, 207, 0.2)';
        ctx.shadowBlur=12;
    }

    dLavender(ctx) {
        ctx.fillStyle=CONFIG.colors.lavenderPurple;
        for(let i=0;i<4;i++){
            for(let j=0;j<3;j++){
                ctx.beginPath();
                ctx.arc(-8+i*5, -5+j*5, 3, 0, Math.PI*2);
                ctx.fill();
            }
        }
        ctx.strokeStyle=CONFIG.colors.lavenderDark;
        ctx.lineWidth=1.5;
        ctx.beginPath();
        ctx.moveTo(0,0);
        ctx.quadraticCurveTo(-3,8,0,18);
        ctx.stroke();
    }

    dTulip(ctx) {
        ctx.fillStyle=CONFIG.colors.tulipPink;
        for(let i=0;i<3;i++){
            ctx.beginPath();
            ctx.rotate(Math.PI*2/3);
            ctx.moveTo(0,-15);
            ctx.quadraticCurveTo(8,-5,5,5);
            ctx.quadraticCurveTo(0,8,-5,5);
            ctx.quadraticCurveTo(-8,-5,0,-15);
            ctx.fill();
        }
        ctx.strokeStyle=CONFIG.colors.tulipGreen;
        ctx.lineWidth=2;
        ctx.beginPath();
        ctx.moveTo(0,5);
        ctx.lineTo(0,20);
        ctx.stroke();
    }

    dPansy(ctx) {
        ctx.fillStyle=CONFIG.colors.pansyPurple;
        for(let i=0;i<5;i++){
            ctx.beginPath();
            ctx.rotate(Math.PI*2/5);
            ctx.ellipse(0,-10,8,10,0,0,Math.PI*2);
            ctx.fill();
        }
        ctx.beginPath();
        ctx.arc(0,0,6,0,Math.PI*2);
        ctx.fillStyle=CONFIG.colors.pansyYellow;
        ctx.fill();
        ctx.fillStyle='#8B8B8B';
        ctx.beginPath();
        ctx.arc(-2,-1,2,0,Math.PI*2);
        ctx.fill();
    }

    dSunflower(ctx) {
        // Ëä±Áì£
        ctx.fillStyle=CONFIG.colors.sunflowerYellow;
        for(let i=0;i<12;i++){
            ctx.beginPath();
            ctx.rotate(Math.PI*2/12);
            ctx.ellipse(18,0,12,5,0,0,Math.PI*2);
            ctx.fill();
        }
        // Ëä±ÂøÉ
        ctx.beginPath();
        ctx.arc(0,0,10,0,Math.PI*2);
        ctx.fillStyle=CONFIG.colors.sunflowerBrown;
        ctx.fill();
    }

    dLily(ctx) {
        // ‰∏âÁâáËä±Áì£
        ctx.fillStyle=CONFIG.colors.lilyWhite;
        for(let i=0;i<6;i++){
            ctx.beginPath();
            ctx.rotate(Math.PI*2/6);
            ctx.moveTo(0,0);
            ctx.quadraticCurveTo(5,-18,0,-22);
            ctx.quadraticCurveTo(-5,-18,0,0);
            ctx.fill();
        }
        // Ëä±Ëïä
        for(let i=0;i<6;i++){
            ctx.fillStyle=CONFIG.colors.lilyYellow;
            ctx.beginPath();
            ctx.arc(Math.cos(i*Math.PI/3)*5, Math.sin(i*Math.PI/3)*5, 2, 0, Math.PI*2);
            ctx.fill();
        }
    }

    dRose(ctx) {
        // ÂÜÖÂ±ÇËä±Áì£
        ctx.fillStyle=CONFIG.colors.roseRed;
        for(let i=0;i<3;i++){
            ctx.beginPath();
            ctx.rotate(Math.PI*2/3);
            ctx.ellipse(0,-8,6,8,0,0,Math.PI*2);
            ctx.fill();
        }
        // Â§ñÂ±ÇËä±Áì£
        ctx.fillStyle=CONFIG.colors.rosePink;
        for(let i=0;i<5;i++){
            ctx.beginPath();
            ctx.rotate(Math.PI*2/5);
            ctx.ellipse(0,-15,8,10,0,0,Math.PI*2);
            ctx.fill();
        }
    }

    dForgetMeNot(ctx) {
        // 5ÁâáÂ∞èËä±Áì£
        ctx.fillStyle=CONFIG.colors.forgetMeNotBlue;
        for(let i=0;i<5;i++){
            ctx.beginPath();
            ctx.rotate(Math.PI*2/5);
            ctx.arc(8,0,6,0,Math.PI*2);
            ctx.fill();
        }
        // Ëä±ÂøÉ
        ctx.beginPath();
        ctx.arc(0,0,4,0,Math.PI*2);
        ctx.fillStyle=CONFIG.colors.forgetMeNotCenter;
        ctx.fill();
    }

    dJasmine(ctx) {
        // 5ÁâáËä±Áì£
        ctx.fillStyle=CONFIG.colors.jasmineWhite;
        for(let i=0;i<5;i++){
            ctx.beginPath();
            ctx.rotate(Math.PI*2/5);
            ctx.moveTo(0,0);
            ctx.lineTo(10,-5);
            ctx.lineTo(12,0);
            ctx.lineTo(10,5);
            ctx.closePath();
            ctx.fill();
        }
        // Ëä±ÂøÉ
        ctx.beginPath();
        ctx.arc(0,0,3,0,Math.PI*2);
        ctx.fillStyle=CONFIG.colors.jasmineYellow;
        ctx.fill();
    }

    dLilyOfValley(ctx) {
        // ÈìÉÈìõÂΩ¢Áä∂ÁöÑËä±Êúµ
        ctx.fillStyle=CONFIG.colors.lilyOfValleyWhite;
        for(let i=0;i<3;i++){
            ctx.save();
            ctx.translate(-10+i*10, i*8);
            ctx.beginPath();
            ctx.moveTo(-5,-8);
            ctx.quadraticCurveTo(-6,-2,-4,2);
            ctx.quadraticCurveTo(0,4,4,2);
            ctx.quadraticCurveTo(6,-2,5,-8);
            ctx.closePath();
            ctx.fill();
            ctx.restore();
        }
        // Ëåé
        ctx.strokeStyle=CONFIG.colors.lilyOfValleyGreen;
        ctx.lineWidth=2;
        ctx.beginPath();
        ctx.moveTo(0,0);
        ctx.quadraticCurveTo(-5,10,0,24);
        ctx.stroke();
    }
}

function showFeedback(text, isSpecial = false) {
    // ÁßªÈô§ÊâÄÊúâÂ∑≤Â≠òÂú®ÁöÑÂèçÈ¶àÊñáÂ≠óÔºåÈÅøÂÖçÈáçÂè†
    document.querySelectorAll('.feedback-text').forEach(el => el.remove());

    const el = document.createElement('div');
    el.className = 'feedback-text';
    if(isSpecial) {
        el.classList.add('special');
    }
    el.textContent = text;
    document.getElementById('uiLayer').appendChild(el);
    setTimeout(() => el.remove(), isSpecial ? 3000 : 2000);
}

function updateCounter() {
    const count = flowers.length;
    if(count > 0) {
        counterEl.classList.add('show');
        counterEl.textContent = `üå∏ √ó${count}`;
    }
}

function initScene() {
    shards=[]; flowers=[]; appearedFlowerTypes.clear(); const c=6; 
    const isMobile = width < 600;
    const sizeRatio = isMobile ? 0.33 : 0.38;
    const r = Math.min(width, height) * sizeRatio; 

    let ang=[]; for(let i=0;i<c;i++)ang.push(Math.random()+0.2); 
    const sum=ang.reduce((a,b)=>a+b,0); 
    let curA=0; 
    let aPts=ang.map(a=>{curA+=(a/sum)*Math.PI*2;return curA;}); 
    const ns=[]; for(let i=0;i<c;i++){let n=[];for(let k=0;k<15;k++)n.push(Math.random()-0.5);ns.push(n);}
    for(let i=0;i<c;i++){ 
        const s=(i==0)?aPts[c-1]-Math.PI*2:aPts[i-1]; 
        const e=aPts[i]; 
        shards.push(new Shard({x:centerX,y:centerY},s,e,(i==0)?ns[c-1]:ns[i-1],ns[i],r)); 
    }
}

function resize() { 
    width=window.innerWidth; height=window.innerHeight; 
    canvas.width=width*dpr; canvas.height=height*dpr; 
    canvas.style.width=width+'px'; canvas.style.height=height+'px'; 
    ctx.scale(dpr,dpr); centerX=width/2; centerY=height/2; 
    if(currentState>=STATE.IDLE)initScene(); 
}

function handleGameClick(e) {
    e.preventDefault();
    if(currentState===STATE.IDLE){ 
        currentState=STATE.BROKEN; 
        hintText.innerHTML="ËØïÁùÄËß¶Á¢∞ÈÇ£‰∫õ<br>Á†¥Á¢éÁöÑÂú∞Êñπ..."; 
        shards.forEach(s=>s.explode()); 
        showFeedback(FEEDBACKS.break);
        setTimeout(()=>{currentState=STATE.GARDENING;},800); 
    } else if(currentState===STATE.GARDENING){
        const pos={x:e.touches?e.touches[0].clientX:e.clientX,y:e.touches?e.touches[0].clientY:e.clientY};
        const dist=Math.hypot(pos.x-centerX,pos.y-centerY);
        if(dist<Math.min(width,height)*0.48){
            const newFlower = new Flower(pos.x,pos.y);
            flowers.push(newFlower);
            updateCounter();

            const count = flowers.length;

            // Ê∏êËøõÂºèÂèçÈ¶àÔºöÂâç10Êúµ100%ÂèçÈ¶àÔºå‰πãÂêé‰ªÖÁâπÊÆäËä±ÊúµÂèçÈ¶à
            if(newFlower.isSpecial) {
                // ÁâπÊÆäËä±ÊúµÔºöÂßãÁªàÊòæÁ§∫Ê≤ªÊÑàÊÄßÊñáÊú¨
                const healingText = getRandomMessage();
                const flower = FLOWER_MEANINGS[newFlower.t];

                // Ê£ÄÊü•ËøôÁßçËä±ÊòØÂê¶Á¨¨‰∏ÄÊ¨°Âá∫Áé∞
                const isFirstTime = !appearedFlowerTypes.has(newFlower.t);
                if(isFirstTime) {
                    appearedFlowerTypes.add(newFlower.t);
                    showFeedback(`‚ú® ${flower.name} ‚ú®\n${healingText}`, true);
                } else {
                    // ‰∏çÊòØÁ¨¨‰∏ÄÊ¨°ÔºåÂè™ÊòæÁ§∫Ê≤ªÊÑàÊñáÊú¨
                    showFeedback(healingText, true);
                }
            } else if(count <= 10) {
                // Ââç10ÊúµÔºö100%ÂèçÈ¶àÔºà‰∏çÈáçÂ§çÔºâ
                if(count === 1) {
                    showFeedback(FEEDBACKS.flower1);
                } else if(count === 3) {
                    showFeedback(FEEDBACKS.flower3);
                } else if(count === 5) {
                    showFeedback(FEEDBACKS.flower5);
                } else {
                    showFeedback(getRandomMessage());
                }
            }
            // count > 10 ‰∏îÈùûÁâπÊÆäËä±ÊúµÔºö‰∏çÊòæÁ§∫ÂèçÈ¶àÔºàÁïôÁôΩÔºâ

            if(count===3){
                hintText.style.opacity=0;
                setTimeout(()=>{
                    hintText.innerHTML="ÊØè‰∏ÄÈÅì‰º§Áóï<br>ÈÉΩËÉΩÂºÄÂá∫Ëä±Êù•";
                    hintText.style.opacity=1;
                },500);
            }
            if(count>5) document.getElementById('generateBtn').classList.add('visible'); 
        }
    }
}

function initChoiceModal() {
    const buttonsContainer = document.getElementById('choiceButtons');
    const confirmBtn = document.getElementById('confirmBtn');
    
    initDisplayedIndices();
    
    CHOICES.forEach(choice => {
        const btn = document.createElement('button');
        btn.className = 'choice-btn';
        btn.textContent = choice;
        btn.addEventListener('click', () => {
            // Áî®Êà∑Á¨¨‰∏ÄÊ¨°‰∫§‰∫íÊó∂Â∞ùËØïÊí≠ÊîæÈü≥‰πê
            startMusic();

            btn.classList.toggle('selected');
            selectedChoices = [];
            document.querySelectorAll('.choice-btn.selected').forEach(b => {
                selectedChoices.push(b.textContent);
            });
            confirmBtn.disabled = selectedChoices.length === 0;
        });
        buttonsContainer.appendChild(btn);
    });

    confirmBtn.addEventListener('click', () => {
        if(selectedChoices.length > 0) {
            // Á°Æ‰øùÈü≥‰πêÂ∑≤ÂºÄÂßãÊí≠Êîæ
            startMusic();

            document.getElementById('choice-modal').classList.remove('show');
            setTimeout(() => {
                currentState = STATE.IDLE;
                initScene();
                canvas.addEventListener('mousedown', handleGameClick);
                canvas.addEventListener('touchstart', handleGameClick, {passive:false});
            }, 600);
        }
    });
}

// Èü≥‰πêÊéßÂà∂ÂäüËÉΩ
document.getElementById('musicControl').addEventListener('click', () => {
    const bgMusic = document.getElementById('bgMusic');
    const musicControl = document.getElementById('musicControl');
    const musicIcon = document.getElementById('musicIcon');
    const mutedIcon = document.getElementById('mutedIcon');

    if(bgMusic.paused) {
        bgMusic.play();
        musicControl.classList.remove('muted');
        musicIcon.style.display = 'block';
        mutedIcon.style.display = 'none';
    } else {
        bgMusic.pause();
        musicControl.classList.add('muted');
        musicIcon.style.display = 'none';
        mutedIcon.style.display = 'block';
    }
});


document.getElementById('generateBtn').addEventListener('click', () => {
    const baseWidth = width < 750 ? 1080 : width * 2;
    const posterWidth = baseWidth;
    const posterHeight = posterWidth * (5 / 3);

    const pc = document.createElement('canvas');
    pc.width = posterWidth; pc.height = posterHeight;
    const pCtx = pc.getContext('2d');
    
    pCtx.fillStyle = CONFIG.colors.grassBg;
    pCtx.fillRect(0, 0, pc.width, pc.height);
    
    pCtx.save();
    const scaleFactor = posterWidth / width;
    pCtx.scale(scaleFactor, scaleFactor);
    const scaledPosterHeight = posterHeight / scaleFactor;
    const verticalShift = (scaledPosterHeight / 2) - centerY;
    pCtx.translate(0, verticalShift);
    shards.forEach(s => s.draw(pCtx));
    flowers.forEach(f => f.draw(pCtx));
    pCtx.restore();
    
    const fontSizeMain = posterWidth * 0.045;
    const fontSizeSub = posterWidth * 0.025;
    pCtx.fillStyle = '#5A7A6A';
    pCtx.textAlign = 'center';
    pCtx.font = `${fontSizeMain}px serif`;
    const quotes = ["ÂÖÅËÆ∏Á†¥Á¢éÔºå‰πüËÉΩËøéÊù•ÁªΩÊîæ", "Âú®ÁîüÂëΩÁöÑË£ÇÈöô‰∏≠ÔºåÂºÄÂá∫Â∏åÊúõ", "‰Ω†‰æùÁÑ∂ÂÆåÊï¥ÔºåÂè™ÊòØÊç¢‰∫Ü‰∏ÄÁßçÂßøÊÄÅÁõõÂºÄ"];
    pCtx.fillText(quotes[Math.floor(Math.random()*quotes.length)], posterWidth / 2, posterHeight * 0.85);
    pCtx.fillStyle = '#8FAFA0';
    pCtx.font = `${fontSizeSub}px serif`;
    const gardenNo = Math.floor(Math.random()*9000+1000);
    pCtx.fillText("„ÄåÁ†¥Á¢éÈáçÊï¥ËÆ°Âàí„ÄçÊ≤ªÊÑàËä±Âõ≠ No." + gardenNo, posterWidth / 2, posterHeight * 0.94);

    document.getElementById('poster-img').src = pc.toDataURL('image/png');
    
    const now = new Date();
    const dateStr = `${now.getFullYear()}.${String(now.getMonth()+1).padStart(2,'0')}.${String(now.getDate()).padStart(2,'0')}`;
    document.getElementById('poster-time').textContent = `ÁîüÊàêÊó∂Èó¥Ôºö${dateStr}`;

    document.getElementById('poster-modal').classList.add('show');
    document.getElementById('poster-modal').style.display = 'flex';
});

function closeModal() {
    document.getElementById('poster-modal').classList.remove('show');
    setTimeout(() => document.getElementById('poster-modal').style.display = 'none', 400);
}

function animate() { 
    ctx.clearRect(0,0,width,height); 
    if(currentState===STATE.BROKEN) shards.forEach(s=>s.update()); 
    shards.forEach(s=>s.draw(ctx)); 
    flowers.forEach(f=>{f.update();f.draw(ctx);});
    requestAnimationFrame(animate); 
}

window.addEventListener('resize', resize);
initChoiceModal();
resize();
animate();

// Â∞ùËØïÂú®È°µÈù¢Âä†ËΩΩÊó∂Êí≠ÊîæÈü≥‰πê
let musicStarted = false;
function startMusic() {
    if(musicStarted) return;
    musicStarted = true;

    const bgMusic = document.getElementById('bgMusic');
    bgMusic.volume = 0;
    bgMusic.play().then(() => {
        // Èü≥ÈáèÊ∑°ÂÖ•
        let targetVolume = 0.4;
        let fadeInInterval = setInterval(() => {
            if(bgMusic.volume < targetVolume) {
                bgMusic.volume = Math.min(bgMusic.volume + 0.02, targetVolume);
            } else {
                clearInterval(fadeInInterval);
            }
        }, 50);

        // ÊòæÁ§∫Èü≥‰πêÊéßÂà∂ÊåâÈíÆ
        setTimeout(() => {
            document.getElementById('musicControl').classList.add('visible');
        }, 1000);
    }).catch(err => {
        console.log('Ëá™Âä®Êí≠ÊîæË¢´ÈòªÊ≠¢ÔºåÁ≠âÂæÖÁî®Êà∑‰∫§‰∫í:', err);
        musicStarted = false; // ÈáçÁΩÆÊ†áÂøóÔºåÂÖÅËÆ∏Âú®Áî®Êà∑‰∫§‰∫íÊó∂ÈáçËØï
    });
}

// È°µÈù¢Âä†ËΩΩÊó∂Â∞ùËØïÊí≠Êîæ
setTimeout(() => {
    startMusic();
}, 1000);

setTimeout(() => {
    document.getElementById('choice-modal').classList.add('show');
}, 500);
</script>
</body>
</html>
